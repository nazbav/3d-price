<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <!-- –ê–¥–∞–ø—Ç–∏–≤ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä 3D-–ø–µ—á–∞—Ç–∏ (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π, –º–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è)</title>
  
  <!-- Bootstrap 5 (CSS) -->
  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
    rel="stylesheet"
  />

  <style>
    /* –û—Å–Ω–æ–≤–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –∏ —Å—Ç–∏–ª–∏ */
    body {
      /* –í–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç—Å—Ç—É–ø–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º bootstrap-–∫–ª–∞—Å—Å—ã –∏–ª–∏ –Ω–µ–±–æ–ª—å—à–∏–µ –æ—Ç—Å—Ç—É–ø—ã. */
      margin: 0;
      padding: 0;
    }
    .container {
      margin-top: 20px;
      margin-bottom: 20px;
    }

    .nav-tabs .nav-link.active {
      font-weight: bold;
    }
    .small-text {
      font-size: 0.9rem;
      color: #555;
    }
    .footer {
      margin-top: 40px;
      font-size: 0.9rem;
      border-top: 1px solid var(--bs-border-color);
      padding-top: 10px;
    }
    table td, 
    table th {
      vertical-align: middle;
      white-space: nowrap; /* –ú–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –ø–µ—Ä–µ–Ω–æ—Å —Å–ª–æ–≤ –≤ —è—á–µ–π–∫–∞—Ö */
    }
    .btn-group-sm > .btn {
      font-size: 0.8rem;
      padding: 2px 6px;
      margin-left: 2px;
    }
    
    thead th {
      background-color: var(--bs-table-bg) !important;
      color: var(--bs-body-color) !important;
    }

    /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞: –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã */
    [data-bs-theme="dark"] thead th {
      background-color: var(--bs-dark-bg-subtle) !important;
      color: var(--bs-light) !important;
    }

    /* –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ –º–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å–∞, —á—Ç–æ–±—ã –ø—Ä–∏ —É–∑–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö –±–ª–æ–∫–∏ –º–æ–≥–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å—Å—è. */
    @media (max-width: 576px) {
      .d-flex {
        flex-wrap: wrap !important;
      }
      .d-flex > * {
        margin-top: .5rem; /* –ù–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ */
      }
      /* –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ —É–º–µ–Ω—å—à–∏—Ç—å —à—Ä–∏—Ñ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:
      h1 {
        font-size: 1.5rem;
      }
      */
    }

  </style>
</head>
<body>

<div class="container">

  <!-- –®–∞–ø–∫–∞ —Å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º —Ç–µ–º—ã -->
  <div class="d-flex justify-content-between align-items-center">
    <h1 class="my-4">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ 3D-–ø–µ—á–∞—Ç–∏</h1>
    <div class="d-flex gap-2">
      <a href="https://github.com/nazbav/3d-price/blob/main/README.md" class="btn btn-outline-primary" target="_blank">README</a>
      <button class="btn btn-outline-secondary" id="themeToggle">üåô –¢–µ–º–Ω–∞—è —Ç–µ–º–∞</button>
    </div>
  </div>

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ -->
  <ul class="nav nav-tabs" id="mainTab" role="tablist">
    <li class="nav-item">
      <button class="nav-link active" id="printers-tab" data-bs-toggle="tab"
              data-bs-target="#printers" type="button" role="tab" aria-controls="printers" 
              aria-selected="true">
        –ü—Ä–∏–Ω—Ç–µ—Ä—ã
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="materials-tab" data-bs-toggle="tab" 
              data-bs-target="#materials" type="button" role="tab" aria-controls="materials" 
              aria-selected="false">
        –ú–∞—Ç–µ—Ä–∏–∞–ª—ã
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="additional-tab" data-bs-toggle="tab"
              data-bs-target="#additional" type="button" role="tab" 
              aria-controls="additional" aria-selected="false">
        –î–æ–ø. —Ä–∞—Å—Ö–æ–¥—ã
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="calculate-tab" data-bs-toggle="tab"
              data-bs-target="#calculate" type="button" role="tab"
              aria-controls="calculate" aria-selected="false">
        –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="importexport-tab" data-bs-toggle="tab"
              data-bs-target="#importexport" type="button" role="tab"
              aria-controls="importexport" aria-selected="false">
        –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç JSON
      </button>
    </li>
  </ul>

  <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–æ–∫ -->
  <div class="tab-content" id="mainTabContent">

    <!-- –í–∫–ª–∞–¥–∫–∞ –ü—Ä–∏–Ω—Ç–µ—Ä—ã -->
    <div class="tab-pane fade show active" id="printers" role="tabpanel" aria-labelledby="printers-tab">
      <div class="mt-4">
        <h3>–°–ø–∏—Å–æ–∫ –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤</h3>
        <p class="small-text">
          –£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, —Å—Ç–æ–∏–º–æ—Å—Ç—å (—Å —É—á—ë—Ç–æ–º –∑–∞–ø—á–∞—Å—Ç–µ–π, —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ –∏ —Ç.–¥.), –∑–∞ —Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –æ–∫—É–ø–∏—Ç—å, 
          –∞ —Ç–∞–∫–∂–µ –º–æ—â–Ω–æ—Å—Ç—å (–í—Ç) –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è (—Ä—É–±/—á–∞—Å).
        </p>

        <button class="btn btn-primary btn-sm mb-3" onclick="onAddPrinter()">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–Ω—Ç–µ—Ä</button>
        <div class="table-responsive">
          <table class="table table-bordered table-hover" id="printersTable">
            <thead class="table-light">
              <tr>
                <th>ID</th>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–°—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</th>
                <th>–ß–∞—Å—ã –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏</th>
                <th>–ú–æ—â–Ω–æ—Å—Ç—å (–í—Ç)</th>
                <th>–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ (‚ÇΩ/—á)</th>
                <th style="width: 140px;">–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody>
              <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã -->
    <div class="tab-pane fade" id="materials" role="tabpanel" aria-labelledby="materials-tab">
      <div class="mt-4">
        <h3>–°–ø–∏—Å–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</h3>
        <p class="small-text">
          –£–∫–∞–∂–∏—Ç–µ —Ç–∏–ø –º–∞—Ç–µ—Ä–∏–∞–ª–∞, —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ 1‚ÄØ–∫–≥, —Å–∫–æ–ª—å–∫–æ –∫–≥ –µ—Å—Ç—å –≤ –Ω–∞–ª–∏—á–∏–∏, –∞ —Ç–∞–∫–∂–µ % –Ω–∞ –±—Ä–∞–∫ (–æ—Ç—Ö–æ–¥).
        </p>
        <button class="btn btn-primary btn-sm mb-3" onclick="onAddMaterial()">–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª</button>
        <div class="table-responsive">
          <table class="table table-bordered table-hover" id="materialsTable">
            <thead class="table-light">
              <tr>
                <th>ID</th>
                <th>–¢–∏–ø –º–∞—Ç–µ—Ä–∏–∞–ª–∞</th>
                <th>–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –∫–≥ (‚ÇΩ)</th>
                <th>–ö–æ–ª-–≤–æ (–∫–≥)</th>
                <th>–û—Ç—Ö–æ–¥ (%)</th>
                <th style="width: 140px;">–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody>
              <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ –î–æ–ø. —Ä–∞—Å—Ö–æ–¥—ã -->
    <div class="tab-pane fade" id="additional" role="tabpanel" aria-labelledby="additional-tab">
      <div class="mt-4">
        <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã</h3>
        <p class="small-text">
          –£–∫–∞–∂–∏—Ç–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –∞–¥–≥–µ–∑–∏–≤, —Å—É—à–∏–ª–∫–∞, —Ñ–∏–ª—å—Ç—Ä—ã, 
          –∞ —Ç–∞–∫–∂–µ –ª—é–±—ã–µ –∏–Ω—ã–µ —Ç—Ä–∞—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´—Ç–µ—Å—Ç–æ–≤–∞—è –ø–µ—á–∞—Ç—å¬ª).
          –ò—Ö —Å—É–º–º–∞ –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ –±—É–¥–µ—Ç ¬´—Ä–∞–∑–º–∞–∑—ã–≤–∞—Ç—å—Å—è¬ª –ø–æ —á–∞—Å–∞–º –ø–µ—á–∞—Ç–∏ (–ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –ø—Ä–∏–Ω—Ç–µ—Ä—É).
        </p>
        <button class="btn btn-primary btn-sm mb-3" onclick="onAddAdditional()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <div class="table-responsive">
          <table class="table table-bordered table-hover" id="additionalTable">
            <thead class="table-light">
              <tr>
                <th>ID</th>
                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th>–°—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</th>
                <th style="width: 120px;">–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody>
              <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä -->
    <div class="tab-pane fade" id="calculate" role="tabpanel" aria-labelledby="calculate-tab">
      <div class="row my-4">
        <div class="col-md-6 mb-3">
          <label class="form-label" for="calcPrinter">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–Ω—Ç–µ—Ä:</label>
          <select class="form-select" id="calcPrinter"></select>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label" for="calcMaterial">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª:</label>
          <select class="form-select" id="calcMaterial"></select>
        </div>
      </div>

      <div class="row my-2">
        <div class="col-md-4 mb-3">
          <label for="calcHours" class="form-label">–í—Ä–µ–º—è –ø–µ—á–∞—Ç–∏ (—á–∞—Å–æ–≤):</label>
          <input type="number" id="calcHours" class="form-control" step="0.1" placeholder="–ù–∞–ø—Ä. 10" />
        </div>
        <div class="col-md-4 mb-3">
          <label for="calcWeight" class="form-label">–í–µ—Å –∏–∑–¥–µ–ª–∏—è (–≥—Ä–∞–º–º):</label>
          <input type="number" id="calcWeight" class="form-control" placeholder="–ù–∞–ø—Ä. 100" />
        </div>
        <div class="col-md-4 mb-3">
          <label for="calcOperatorRate" class="form-label">
            –°—Ç–∞–≤–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ (‚ÇΩ/—á–∞—Å):
          </label>
          <input type="number" id="calcOperatorRate" class="form-control" placeholder="–ù–∞–ø—Ä. 200" />
        </div>
      </div>

      <hr/>
      <h5>–ü—Ä–æ—á–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h5>
      <div class="row my-2">
        <div class="col-md-4 mb-3">
          <label for="calcWorkHoursDay" class="form-label">
            –†–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å:
          </label>
          <input type="number" id="calcWorkHoursDay" class="form-control" placeholder="–ù–∞–ø—Ä. 8" />
        </div>
        <div class="col-md-4 mb-3">
          <label for="calcStartDate" class="form-label">
            –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:
          </label>
          <input type="date" id="calcStartDate" class="form-control" />
        </div>
        <div class="col-md-4 mb-3">
          <label for="calcCostKwh" class="form-label">
            –¶–µ–Ω–∞ 1‚ÄØ–∫–í—Ç‚ãÖ—á (‚ÇΩ):
          </label>
          <input type="number" step="0.01" id="calcCostKwh" class="form-control" placeholder="–ù–∞–ø—Ä. 6" />
        </div>
      </div>

      <div class="row my-2">
        <div class="col-md-4 mb-3">
          <label for="calcShipping" class="form-label">
            –î–æ—Å—Ç–∞–≤–∫–∞/–£–ø–∞–∫–æ–≤–∫–∞ (‚ÇΩ):
          </label>
          <input type="number" step="1" id="calcShipping" class="form-control" placeholder="–ù–∞–ø—Ä. 200" />
        </div>
        <div class="col-md-4 mb-3">
          <label for="calcTaxPercent" class="form-label">
            –ù–∞–ª–æ–≥ (%):
          </label>
          <input type="number" step="1" id="calcTaxPercent" class="form-control" placeholder="–ù–∞–ø—Ä. 6" />
        </div>
      </div>

      <div class="my-2">
        <button id="btnCalculate" class="btn btn-success" onclick="onCalculate()">
          –†–∞—Å—Å—á–∏—Ç–∞—Ç—å
        </button>
      </div>

      <div class="alert alert-info mt-3" id="calcResult" style="display: none;"></div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç JSON -->
    <div class="tab-pane fade" id="importexport" role="tabpanel" aria-labelledby="importexport-tab">
      <div class="mt-4">
        <h3>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ JSON</h3>
        <p>
          –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –≤—ã–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ø—Ä–∏–Ω—Ç–µ—Ä—ã, –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –¥–æ–ø. —Ä–∞—Å—Ö–æ–¥—ã) 
          –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –≤ –≤–∏–¥–µ JSON.
        </p>
        <button class="btn btn-primary" onclick="onExportJson()">–í—ã–≥—Ä—É–∑–∏—Ç—å JSON</button>
        <textarea 
          id="exportArea" 
          class="form-control mt-2" 
          rows="5" 
          placeholder="–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON"></textarea>
      </div>
      <hr />
      <div class="mt-4">
        <h3>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ JSON</h3>
        <p>
          –í—Å—Ç–∞–≤—å—Ç–µ JSON –≤ –ø–æ–ª–µ –Ω–∏–∂–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å¬ª. 
          –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ JSON.
        </p>
        <textarea 
          id="importArea" 
          class="form-control" 
          rows="5" 
          placeholder="{ ... }"></textarea>
        <button class="btn btn-success mt-2" onclick="onImportJson()">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>
    </div>

  </div>

  <!-- –ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å -->
  <div class="footer">
    <p class="mb-1">
      –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ (LocalStorage) –ø—Ä–∏ –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.
    </p>
    <p class="mb-0">
      –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã –º–æ–∂–µ—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–≤ –ø—É—Å—Ç–æ–π JSON –∏–ª–∏ –æ—á–∏—Å—Ç–∏–≤ LocalStorage –≤—Ä—É—á–Ω—É—é.
    </p>
  </div>

  <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–µ—Ä–≤—É—é –≤–µ—Ä—Å–∏—é -->
  <div class="mt-4">
    <a href="index1.html"><h6>–ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (—Ç—ã–∫)</h6></a>
    <a href="index3.html"><h6>–¢—Ä–µ—Ç—å—è –≤–µ—Ä—Å–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (—Ç—ã–∫)</h6></a>
    <p><span style="text-decoration:line-through">¬©</span>2025 –ù–∏—á—å–∏ –ø—Ä–∞–≤–∞ –Ω–µ –∑–∞—â–∏—â–µ–Ω—ã.</p>
  </div>

</div>

<!-- Bootstrap Bundle (JS + Popper) -->
<script 
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js">
</script>

<script>

// –ö–ª—é—á –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–º—ã –≤ LocalStorage
const THEME_STORAGE_KEY = "themePreference";

// –§—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–º—ã
function setTheme(theme) {
  document.documentElement.setAttribute("data-bs-theme", theme);
  localStorage.setItem(THEME_STORAGE_KEY, theme);
  document.getElementById("themeToggle").innerText = theme === "dark" ? "‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞" : "üåô –¢–µ–º–Ω–∞—è —Ç–µ–º–∞";
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã –ø—Ä–∏ –∫–ª–∏–∫–µ
document.getElementById("themeToggle").addEventListener("click", () => {
  const currentTheme = document.documentElement.getAttribute("data-bs-theme");
  const newTheme = currentTheme === "dark" ? "light" : "dark";
  setTheme(newTheme);
});

// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
const savedTheme = localStorage.getItem(THEME_STORAGE_KEY) || "light";
setTheme(savedTheme);

/** ========================================================
 *   1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∏ LocalStorage
 * =========================================================
 */

// –ö–ª—é—á –¥–ª—è localStorage
const STORAGE_KEY = 'ThreeDPrintCalc_FullFactors_v1';

// –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
let appData = {
  printers: [
    {
      id: 1,
      name: "Ender 3 v3 se",
      cost: 20000,
      hoursToRecoup: 500,
      power: 350,
      maintCostHour: 5
    },
    {
      id: 2,
      name: "FlashForge Adventurer 5M",
      cost: 35000,
      hoursToRecoup: 500,
      power: 350,
      maintCostHour: 5
    }
  ],
  materials: [
    {
      id: 1,
      name: "HIPS",
      costPerKg: 700,
      availableKg: 1,
      wastePercent: 1
    },
    {
      id: 2,
      name: "ABS",
      costPerKg: 800,
      availableKg: 2,
      wastePercent: 5
    },
    {
      id: 3,
      name: "PLA",
      costPerKg: 1500,
      availableKg: 1,
      wastePercent: 1
    },
    {
      id: 4,
      name: "PET-G",
      costPerKg: 800,
      availableKg: 4,
      wastePercent: 3
    }
  ],
  additional: [
    {
      id: 2,
      description: "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–ª–∞—Å—Ç–∏–∫–∞",
      cost: 2000
    }
  ],
  calcSettings: {
    operatorRate: 5,
    workHoursDay: 3,
    startDate: "2025-01-22",
    costKwh: 1,
    shipping: 10,
    taxPercent: 3
  }
};

function saveToLocalStorage() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(appData));
}

function loadFromLocalStorage() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      const obj = JSON.parse(saved);
      if (obj) {
        appData = obj;
      }
    }
  } catch (err) {
    console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ localStorage:', err);
  }
}

/** ========================================================
 *   2. –û—Ç—Ä–∏—Å–æ–≤–∫–∞ (—Ä–µ–Ω–¥–µ—Ä) —Ç–∞–±–ª–∏—Ü + CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏
 * =========================================================
 */
function renderAllTables() {
  renderPrintersTable();
  renderMaterialsTable();
  renderAdditionalTable();
}

/** ------------------ –ü—Ä–∏–Ω—Ç–µ—Ä—ã ------------------ */
function renderPrintersTable() {
  const tbody = document.querySelector('#printersTable tbody');
  tbody.innerHTML = '';
  
  appData.printers.forEach((printer) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${printer.id}<\/td>
      <td>${printer.name}<\/td>
      <td>${printer.cost}<\/td>
      <td>${printer.hoursToRecoup}<\/td>
      <td>${printer.power}<\/td>
      <td>${printer.maintCostHour}<\/td>
      <td>
        <div class="btn-group-sm">
          <button class="btn btn-secondary" onclick="onEditPrinter(${printer.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å<\/button>
          <button class="btn btn-danger" onclick="onDeletePrinter(${printer.id})">–£–¥–∞–ª–∏—Ç—å<\/button>
        <\/div>
      <\/td>
    `;
    tbody.appendChild(tr);
  });
}

function onAddPrinter() {
  const newId = Date.now();
  const newPrinter = {
    id: newId,
    name: '–ù–æ–≤—ã–π –ø—Ä–∏–Ω—Ç–µ—Ä',
    cost: 0,
    hoursToRecoup: 500,
    power: 0,
    maintCostHour: 0
  };
  appData.printers.push(newPrinter);
  saveToLocalStorage();
  renderPrintersTable();
}

function onEditPrinter(id) {
  const printer = appData.printers.find(p => p.id === id);
  if (!printer) return;

  const name = prompt('–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–Ω—Ç–µ—Ä–∞:', printer.name);
  if (name === null) return;
  const cost = prompt('–°—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±):', printer.cost);
  if (cost === null) return;
  const hours = prompt('–ß–∞—Å—ã –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏:', printer.hoursToRecoup);
  if (hours === null) return;
  const power = prompt('–ú–æ—â–Ω–æ—Å—Ç—å (–í—Ç):', printer.power);
  if (power === null) return;
  const maint = prompt('–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ (—Ä—É–±/—á):', printer.maintCostHour);
  if (maint === null) return;

  printer.name = name;
  printer.cost = parseFloat(cost) || 0;
  printer.hoursToRecoup = parseFloat(hours) || 1;
  printer.power = parseFloat(power) || 0;
  printer.maintCostHour = parseFloat(maint) || 0;

  saveToLocalStorage();
  renderPrintersTable();
}

function onDeletePrinter(id) {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–Ω—Ç–µ—Ä —Å id=' + id + '?')) return;
  appData.printers = appData.printers.filter(p => p.id !== id);
  saveToLocalStorage();
  renderPrintersTable();
}

/** ------------------ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã ------------------ */
function renderMaterialsTable() {
  const tbody = document.querySelector('#materialsTable tbody');
  tbody.innerHTML = '';
  
  appData.materials.forEach((mat) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${mat.id}<\/td>
      <td>${mat.name}<\/td>
      <td>${mat.costPerKg}<\/td>
      <td>${mat.availableKg}<\/td>
      <td>${mat.wastePercent}<\/td>
      <td>
        <div class="btn-group-sm">
          <button class="btn btn-secondary" onclick="onEditMaterial(${mat.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å<\/button>
          <button class="btn btn-danger" onclick="onDeleteMaterial(${mat.id})">–£–¥–∞–ª–∏—Ç—å<\/button>
        <\/div>
      <\/td>
    `;
    tbody.appendChild(tr);
  });
}

function onAddMaterial() {
  const newId = Date.now();
  const newMat = {
    id: newId,
    name: '–ù–æ–≤—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª',
    costPerKg: 0,
    availableKg: 0,
    wastePercent: 0
  };
  appData.materials.push(newMat);
  saveToLocalStorage();
  renderMaterialsTable();
}

function onEditMaterial(id) {
  const mat = appData.materials.find(m => m.id === id);
  if (!mat) return;

  const name = prompt('–¢–∏–ø –º–∞—Ç–µ—Ä–∏–∞–ª–∞:', mat.name);
  if (name === null) return;
  const cost = prompt('–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –∫–≥:', mat.costPerKg);
  if (cost === null) return;
  const kg = prompt('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–∫–≥):', mat.availableKg);
  if (kg === null) return;
  const waste = prompt('–û—Ç—Ö–æ–¥ (%):', mat.wastePercent);
  if (waste === null) return;

  mat.name = name;
  mat.costPerKg = parseFloat(cost) || 0;
  mat.availableKg = parseFloat(kg) || 0;
  mat.wastePercent = parseFloat(waste) || 0;

  saveToLocalStorage();
  renderMaterialsTable();
}

function onDeleteMaterial(id) {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª —Å id=' + id + '?')) return;
  appData.materials = appData.materials.filter(m => m.id !== id);
  saveToLocalStorage();
  renderMaterialsTable();
}

/** ------------------ –î–æ–ø. —Ä–∞—Å—Ö–æ–¥—ã ------------------ */
function renderAdditionalTable() {
  const tbody = document.querySelector('#additionalTable tbody');
  tbody.innerHTML = '';

  appData.additional.forEach((item) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${item.id}<\/td>
      <td>${item.description}<\/td>
      <td>${item.cost}<\/td>
      <td>
        <div class="btn-group-sm">
          <button class="btn btn-secondary" onclick="onEditAdditional(${item.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å<\/button>
          <button class="btn btn-danger" onclick="onDeleteAdditional(${item.id})">–£–¥–∞–ª–∏—Ç—å<\/button>
        <\/div>
      <\/td>
    `;
    tbody.appendChild(tr);
  });
}

function onAddAdditional() {
  const newId = Date.now();
  const newItem = {
    id: newId,
    description: '–ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è —Ä–∞—Å—Ö–æ–¥–æ–≤',
    cost: 0
  };
  appData.additional.push(newItem);
  saveToLocalStorage();
  renderAdditionalTable();
}

function onEditAdditional(id) {
  const item = appData.additional.find(a => a.id === id);
  if (!item) return;

  const desc = prompt('–û–ø–∏—Å–∞–Ω–∏–µ:', item.description);
  if (desc === null) return;
  const cost = prompt('–°—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ):', item.cost);
  if (cost === null) return;

  item.description = desc;
  item.cost = parseFloat(cost) || 0;

  saveToLocalStorage();
  renderAdditionalTable();
}

function onDeleteAdditional(id) {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ç—å—é —Ä–∞—Å—Ö–æ–¥–æ–≤ —Å id=' + id + '?')) return;
  appData.additional = appData.additional.filter(a => a.id !== id);
  saveToLocalStorage();
  renderAdditionalTable();
}

/** ========================================================
 *   3. –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (—É—á—ë—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞, –≥—Ä–∞—Ñ–∏–∫–∞, —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–∞, etc.)
 * =========================================================
 */
function fillCalcSelects() {
  // –ü—Ä–∏–Ω—Ç–µ—Ä—ã
  const selPrinter = document.getElementById('calcPrinter');
  selPrinter.innerHTML = '';
  appData.printers.forEach((p) => {
    const opt = document.createElement('option');
    opt.value = p.id;
    opt.textContent = p.name;
    selPrinter.appendChild(opt);
  });

  // –ú–∞—Ç–µ—Ä–∏–∞–ª—ã
  const selMaterial = document.getElementById('calcMaterial');
  selMaterial.innerHTML = '';
  appData.materials.forEach((m) => {
    const opt = document.createElement('option');
    opt.value = m.id;
    opt.textContent = m.name;
    selMaterial.appendChild(opt);
  });

  // –ó–∞–ø–æ–ª–Ω–∏–º –ø–æ–ª—è –∏–∑ calcSettings
  document.getElementById('calcOperatorRate').value = appData.calcSettings.operatorRate || '';
  document.getElementById('calcWorkHoursDay').value = appData.calcSettings.workHoursDay || '';
  document.getElementById('calcStartDate').value = appData.calcSettings.startDate || '';
  document.getElementById('calcCostKwh').value = appData.calcSettings.costKwh || '';
  document.getElementById('calcShipping').value = appData.calcSettings.shipping || '';
  document.getElementById('calcTaxPercent').value = appData.calcSettings.taxPercent || '';
}

function onCalculate() {
  // –°—á–∏—Ç—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–ª—è:
  const rate = parseFloat(document.getElementById('calcOperatorRate').value) || 0;
  const whDay = parseFloat(document.getElementById('calcWorkHoursDay').value) || 8;
  const startDateVal = document.getElementById('calcStartDate').value;
  const costKwh = parseFloat(document.getElementById('calcCostKwh').value) || 0;
  const shippingCost = parseFloat(document.getElementById('calcShipping').value) || 0;
  const taxPercent = parseFloat(document.getElementById('calcTaxPercent').value) || 0;

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Ö –≤ appData:
  appData.calcSettings.operatorRate = rate;
  appData.calcSettings.workHoursDay = whDay;
  appData.calcSettings.startDate = startDateVal;
  appData.calcSettings.costKwh = costKwh;
  appData.calcSettings.shipping = shippingCost;
  appData.calcSettings.taxPercent = taxPercent;
  saveToLocalStorage();

  // –ë–µ—Ä—ë–º –≤—ã–±–æ—Ä –ø—Ä–∏–Ω—Ç–µ—Ä–∞/–º–∞—Ç–µ—Ä–∏–∞–ª–∞
  const printerId = parseInt(document.getElementById('calcPrinter').value, 10);
  const materialId = parseInt(document.getElementById('calcMaterial').value, 10);
  const hours = parseFloat(document.getElementById('calcHours').value) || 0;
  const grams = parseFloat(document.getElementById('calcWeight').value) || 0;

  const printer = appData.printers.find((p) => p.id === printerId);
  const material = appData.materials.find((m) => m.id === materialId);

  if (!printer || !material) {
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–Ω—Ç–µ—Ä –∏ –º–∞—Ç–µ—Ä–∏–∞–ª.');
    return;
  }

  /** 1) –ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–∏–Ω—Ç–µ—Ä–∞ */
  let costPerHourPrinter = 0;
  if (printer.hoursToRecoup && printer.hoursToRecoup > 0) {
    costPerHourPrinter = printer.cost / printer.hoursToRecoup;
  } else {
    costPerHourPrinter = printer.cost;
  }
  const costPrinterPart = hours * costPerHourPrinter;

  /** 2) –û–ø–ª–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ */
  const costOperatorPart = hours * rate;

  /** 3) –ú–∞—Ç–µ—Ä–∏–∞–ª (—Å —É—á—ë—Ç–æ–º % –æ—Ç—Ö–æ–¥–∞) */
  const realGrams = grams * (1 + (material.wastePercent / 100));
  const costPerGram = (material.costPerKg / 1000);
  const costMaterialPart = realGrams * costPerGram;

  /** 4) –î–æ–ø. —Ä–∞—Å—Ö–æ–¥—ã (–ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —á–∞—Å–∞–º –ø–µ—á–∞—Ç–∏) */
  const sumAdditional = appData.additional.reduce((acc, x) => acc + x.cost, 0);
  let costAdditionalPart = 0;
  if (printer.hoursToRecoup > 0) {
    const costPerHourAdditional = sumAdditional / printer.hoursToRecoup;
    costAdditionalPart = costPerHourAdditional * hours;
  }

  /** 5) –≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ: 
   *   (–º–æ—â–Ω–æ—Å—Ç—å –í—Ç / 1000) –∫–í—Ç * (–≤—Ä–µ–º—è —á) * (—Ü–µ–Ω–∞ –∑–∞ –∫–í—Ç‚ãÖ—á)
   */
  const costElectric = (printer.power / 1000) * hours * costKwh;

  /** 6) –ò–∑–Ω–æ—Å/–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–∏–Ω—Ç–µ—Ä–∞ (maintCostHour) */
  const costMaintenance = printer.maintCostHour * hours;

  /** 7) –£–ø–∞–∫–æ–≤–∫–∞/–¥–æ—Å—Ç–∞–≤–∫–∞ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è) */
  const costShipping = shippingCost;

  /** –°—É–º–º–∞ –±–µ–∑ —É—á—ë—Ç–∞ –Ω–∞–ª–æ–≥–∞ */
  const subTotal = 
        costPrinterPart
      + costOperatorPart
      + costMaterialPart
      + costAdditionalPart
      + costElectric
      + costMaintenance
      + costShipping;

  /** 8) –ù–∞–ª–æ–≥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 6% –¥–ª—è —Å–∞–º–æ–∑–∞–Ω—è—Ç—ã—Ö/–£–°–ù) */
  const costTax = subTotal * (taxPercent / 100);

  /** –ò—Ç–æ–≥–æ */
  const total = subTotal + costTax;

  /** –†–∞—Å—á—ë—Ç —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π */
  let daysNeeded = 0;
  if (whDay > 0) {
    daysNeeded = Math.ceil(hours / whDay);
  }
  let finishDateStr = '';
  if (startDateVal) {
    try {
      const startD = new Date(startDateVal);
      startD.setDate(startD.getDate() + daysNeeded);
      finishDateStr = startD.toLocaleDateString('ru-RU');
    } catch (err) {
      console.error('–û—à–∏–±–∫–∞ –¥–∞—Ç—ã:', err);
    }
  }

  /** –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
  const elRes = document.getElementById('calcResult');
  elRes.style.display = 'block';

  elRes.innerHTML = `
    <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á—ë—Ç–∞:<\/strong><br/>
    –ü—Ä–∏–Ω—Ç–µ—Ä: ${printer.name}<br/>
    –ú–∞—Ç–µ—Ä–∏–∞–ª: ${material.name}<br/>
    –í—Ä–µ–º—è –ø–µ—á–∞—Ç–∏: ${hours} —á.<br/>
    –í–µ—Å –∏–∑–¥–µ–ª–∏—è (–≥): ${grams}, 
      —Å —É—á—ë—Ç–æ–º –±—Ä–∞–∫–∞ (${material.wastePercent}%) = ${realGrams.toFixed(2)} –≥.<br/>
    <hr/>
    –°—É–º–º–∞ –±–µ–∑ –Ω–∞–ª–æ–≥–∞: ${subTotal.toFixed(2)} ‚ÇΩ<br/>
    –ù–∞–ª–æ–≥ (${taxPercent}%): ${costTax.toFixed(2)} ‚ÇΩ<br/>
    <strong>–ò—Ç–æ–≥–æ: ${total.toFixed(2)} ‚ÇΩ<\/strong><br/><br/>
  `;

  
  if (daysNeeded > 0) {
    elRes.innerHTML += `
      –ü—Ä–∏ ${whDay} —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–∞—Ö –≤ –¥–µ–Ω—å, –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è ~${daysNeeded} –¥–Ω.<br/>
    `;
    if (finishDateStr) {
      elRes.innerHTML += `–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è: ${finishDateStr}<br/>`;
    }
  }
  
   elRes.innerHTML += `
     <hr/>
    <strong>–†–∞–∑–±–∏–≤–∫–∞ –∑–∞—Ç—Ä–∞—Ç (–±–µ–∑ –Ω–∞–ª–æ–≥–∞):<\/strong><br/>
    - –ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–∏–Ω—Ç–µ—Ä–∞: ${costPrinterPart.toFixed(2)} ‚ÇΩ<br/>
    - –û–ø–ª–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞: ${costOperatorPart.toFixed(2)} ‚ÇΩ<br/>
    - –ú–∞—Ç–µ—Ä–∏–∞–ª: ${costMaterialPart.toFixed(2)} ‚ÇΩ<br/>
    - –î–æ–ø. —Ä–∞—Å—Ö–æ–¥—ã (–ø–æ —á–∞—Å—É): ${costAdditionalPart.toFixed(2)} ‚ÇΩ<br/>
    - –≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è: ${costElectric.toFixed(2)} ‚ÇΩ<br/>
    - –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–∏–Ω—Ç–µ—Ä–∞: ${costMaintenance.toFixed(2)} ‚ÇΩ<br/>
    - –£–ø–∞–∫–æ–≤–∫–∞/–¥–æ—Å—Ç–∞–≤–∫–∞: ${costShipping.toFixed(2)} ‚ÇΩ<br/><br/>
  `;

}

/** ========================================================
 *   4. –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç JSON
 * =========================================================
 */
function onExportJson() {
  const jsonStr = JSON.stringify(appData, null, 2);
  document.getElementById('exportArea').value = jsonStr;
}

function onImportJson() {
  const jsonStr = document.getElementById('importArea').value.trim();
  if (!jsonStr) {
    if (confirm('–ü–æ–ª–µ JSON –ø—É—Å—Ç–æ–µ. –≠—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ —Å–±—Ä–æ—Å—É –¥–∞–Ω–Ω—ã—Ö –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
      localStorage.removeItem(STORAGE_KEY);
      location.reload();
    }
    return;
  }

  try {
    const obj = JSON.parse(jsonStr);
    appData = obj;
    saveToLocalStorage();
    renderAllTables();
    fillCalcSelects();
    alert('–ò–º–ø–æ—Ä—Ç —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω.');
  } catch (err) {
    alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ JSON: ' + err);
  }
}

/** ========================================================
 *   –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
 * =========================================================
 */
document.addEventListener('DOMContentLoaded', () => {
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage
  loadFromLocalStorage();

  // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã
  renderAllTables();

  // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç—ã –Ω–∞ –≤–∫–ª–∞–¥–∫–µ "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä"
  fillCalcSelects();
});
</script>

</body>
</html>
